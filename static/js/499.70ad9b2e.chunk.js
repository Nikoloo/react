"use strict";(self.webpackChunkspotify_webapp=self.webpackChunkspotify_webapp||[]).push([[499],{499:(e,t,r)=>{r.d(t,{A:()=>i,spotifyAuth:()=>a});class o{constructor(e){this.clientId=void 0,this.redirectUri=void 0,this.scopes=void 0,this.codeVerifier="",this.clientId=e.clientId,this.redirectUri=e.redirectUri,this.scopes=e.scopes}generateCodeVerifier(){const e=new Uint8Array(32);return crypto.getRandomValues(e),btoa(String.fromCharCode.apply(null,Array.from(e))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async generateCodeChallenge(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t);return btoa(String.fromCharCode.apply(null,Array.from(new Uint8Array(r)))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async initiateAuth(){this.codeVerifier=this.generateCodeVerifier();const e=await this.generateCodeChallenge(this.codeVerifier);localStorage.setItem("spotify_code_verifier",this.codeVerifier);const t=`https://accounts.spotify.com/authorize?${new URLSearchParams({client_id:this.clientId,response_type:"code",redirect_uri:this.redirectUri,code_challenge_method:"S256",code_challenge:e,scope:this.scopes.join(" "),state:this.generateState()}).toString()}`;window.location.href=t}generateState(){const e=new Uint8Array(16);crypto.getRandomValues(e);const t=btoa(String.fromCharCode.apply(null,Array.from(e)));return localStorage.setItem("spotify_auth_state",t),t}async handleCallback(e,t){if(t!==localStorage.getItem("spotify_auth_state"))throw new Error("Invalid state parameter");const r=localStorage.getItem("spotify_code_verifier");if(!r)throw new Error("Code verifier not found");const o=await this.exchangeCodeForToken(e,r);return localStorage.removeItem("spotify_code_verifier"),localStorage.removeItem("spotify_auth_state"),this.storeTokens(o),o}async exchangeCodeForToken(e,t){const r=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:this.redirectUri,client_id:this.clientId,code_verifier:t})});if(!r.ok){const e=await r.json();throw new Error(`Token exchange failed: ${e.error_description}`)}return r.json()}async refreshToken(){const e=localStorage.getItem("spotify_refresh_token");if(!e)throw new Error("No refresh token available");const t=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e,client_id:this.clientId})});if(!t.ok){const e=await t.json();throw new Error(`Token refresh failed: ${e.error_description}`)}const r=await t.json();return this.storeTokens(r),r}storeTokens(e){const t=Date.now()+1e3*e.expires_in;localStorage.setItem("spotify_access_token",e.access_token),localStorage.setItem("spotify_token_expiration",t.toString()),e.refresh_token&&localStorage.setItem("spotify_refresh_token",e.refresh_token)}async getValidToken(){const e=localStorage.getItem("spotify_access_token"),t=localStorage.getItem("spotify_token_expiration");if(!e||!t)return null;if(Date.now()>parseInt(t)-3e5)try{return(await this.refreshToken()).access_token}catch(r){return console.error("Token refresh failed:",r),this.logout(),null}return e}isAuthenticated(){const e=localStorage.getItem("spotify_access_token"),t=localStorage.getItem("spotify_token_expiration");return!(!e||!t)&&Date.now()<parseInt(t)}async getCurrentUser(){const e=await this.getValidToken();if(!e)throw new Error("No valid token available");const t=await fetch("https://api.spotify.com/v1/me",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to get user data");return t.json()}logout(){localStorage.removeItem("spotify_access_token"),localStorage.removeItem("spotify_refresh_token"),localStorage.removeItem("spotify_token_expiration"),localStorage.removeItem("spotify_code_verifier"),localStorage.removeItem("spotify_auth_state")}static parseCallback(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.href;const t=new URLSearchParams(new URL(e).search);return{code:t.get("code")||void 0,state:t.get("state")||void 0,error:t.get("error")||void 0}}}const a=new o({clientId:"b77eca5b73724310ac6499de78621e58",redirectUri:"https://nikoloo.github.io/react/callbackk",scopes:["user-read-private","user-read-email","user-library-read","user-library-modify","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","playlist-read-private","playlist-modify-private","playlist-modify-public","user-follow-read","user-follow-modify","user-read-recently-played","user-top-read"]}),i=o}}]);